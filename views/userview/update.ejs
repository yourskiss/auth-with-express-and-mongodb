<!DOCTYPE html>
<html>
<head>
  <title>Update User Details</title>
</head>
<body>
<%- include('../partials/header') %>
<section class="sectionmin">
  <h1 class="mainheading">
    <% if (user.role === 'superadmin') { %>Update Admin<% } else {  %>Update User<% } %>
  </h1>
  <p class="maintext">
    Please update the details below and submit to save changes.
  </p>
  <h4 class="backto">
     <% if(querydata.page == '0' && querydata.sortBy == '0' && querydata.order == '0') { %> 
      <a href="/users/dashboard"  class="btn btn-back">Back</a>
    <% } else { %>
      <a href="/users/?page=<%= querydata.page %>&sortBy=<%= querydata.sortBy %>&order=<%= querydata.order %>" class="btn btn-back">Back</a>
    <% }   %>
  </h4>
  
  <form class="formpart" action="/users/update/<%= result.id %>" method="post" enctype="multipart/form-data">
    <% if (error) { %>
      <aside class="errormessage"><%= error %></aside>
    <% } %>
    <% if (success) { %>
      <aside class="successmessage"><%= success %></aside>
      <script>
        const page = "<%= querydata.page %>";
        const sortBy = "<%= querydata.sortBy %>";
        const order = "<%= querydata.order %>";
        if (page === '0' && sortBy === '0' && order === '0') {
          setTimeout(() => {
            window.location.href = "/users/dashboard";
          }, 2000);
        } else {
          setTimeout(() => {
            window.location.href = `/users/?page=${page}&sortBy=${sortBy}&order=${order}`;
          }, 2000);
        }
      </script>
    <% } %>
    <input type="hidden" name="page" value="<%= querydata.page %>">
    <input type="hidden" name="sortBy" value="<%= querydata.sortBy %>">
    <input type="hidden" name="order" value="<%= querydata.order %>">

    <div style="display: flex; justify-content: space-between; align-items: center;">
        <div>
          <label>Profile Photo</label>
          <input type="file" name="profilepicture" accept="image/*" />
        </div>
      <% if (result.profilepicture && result.profilepicture.url) { %>
          <img src="<%= result.profilepicture.url %>" alt="Profile Photo" width="100" />
      <% } %>
    </div>
    <div>
        <label>Fullname:</label>
        <input 
            type="text" 
            name="fullname" 
             value="<%= result.fullname || '' %>"
        />
    </div>
    <div>
        <label>Mobile:</label>
        <input 
            type="text" 
            name="mobile" 
            value="<%= result.mobile || '' %>"
            maxlength="10"
        />
    </div>
    <div>
        <label>Email:</label>
        <input 
            type="text" 
            name="email" 
            value="<%= result.email || '' %>"
        />
    </div>
    <% if(user.id !== result.id) { %>
    <div> 
        <label>Role:</label>
        <select name="role">
          <option value="" disabled <%= !result.role ? 'selected' : '' %>>Select</option>
          <% if(user.role === 'admin') { %> <option value="user" <%= result.role === 'user' ? 'selected' : '' %> >User</option> <% } %>
          <% if(user.role === 'superadmin') { %> <option value="admin" <%= result.role === 'admin' ? 'selected' : '' %> >Admin</option> <% } %>
          <!-- <option value="superadmin" <%= result.role === 'superadmin' ? 'selected' : '' %>>Superadmin</option> -->
        </select>
    </div>
    <% } %>
    <div>
      <button type="submit">Update</button>
    </div>
  </form>
</section>
<%- include('../partials/footer', { title: 'EMP Management System' }) %>
</body>
</html>
