<!DOCTYPE html>
<html>
<head>
  <title>All User List</title>

</head>
<body>
<%- include('../partials/header') %>
<section class="sectionmin">

  <h1 class="mainheading">
    Active List
  </h1>
 
 
  <% if (error) { %>
      <h6 class="mainError"><%= error %></h6>
  <% }   %>

<div class="sortcontrols">
  <h5>
    Deactive  List <a href="/users/deactive">Click Here</a>
  </h5>
  <% 
    const primary = sortBy === 'createdAt';
    const secondary = sortBy === 'fullname'; 
  %>
  <p>
    <b>Sort : &nbsp;</b>
    <a href="?page=1&sortBy=fullname&order=<%= secondary && order === 1 ? 'desc' : 'asc' %>" class="<%= secondary ? 'active' : '' %>">
     By Name <%= secondary ? (order === 1 ? '▲' : '▼') : ' ' %>
    </a>
     &nbsp; 
    <a href="?page=1&sortBy=createdAt&order=<%= primary && order === 1 ? 'desc' : 'asc' %>" class="<%= primary ? 'active' : '' %>">
      Created By <%= primary ? (order === 1 ? '▲' : '▼') : ' ' %>
    </a>
     &nbsp; 
  </p>
</div>

    <% result.forEach((res) => { %>
        <div class="record_list enabled" >
            <% if (res.profilepicture && res.profilepicture.url) { %>
                <img src="<%= res.profilepicture.url %>" alt="Profile Photo" />
            <% } %>
            <p>
                <strong>Full Name:</strong> <%= res.fullname %> || <strong>Role:</strong> <%= res.role %><br> 
                <strong>Mobile:</strong> <%= res.mobile %> || <strong>Email:</strong> <%= res.email %><br>
                <strong>Created At:</strong> <%= new Date(res.createdAt).toLocaleString() %><br>
                <% 
                const createdDate = new Date(res.createdAt);
                const updatedDate = new Date(res.updatedAt);
                if (createdDate.getTime() < updatedDate.getTime()) { %>
                  <strong>Updated At:</strong> <%= new Date(res.updatedAt).toLocaleString() %><br>
                <% } %>
            </p>
            <aside>
                <a href="/users/detail/<%= res.id %>?page=<%= currentPage || 1 %>&sortBy=<%= sortBy || 'createdAt' %>&order=<%= order === 1 ? 'asc' : 'desc' %>" class="btn">View </a>  
                <a href="/users/update/<%= res.id %>?page=<%= currentPage || 1 %>&sortBy=<%= sortBy || 'createdAt' %>&order=<%= order === 1 ? 'asc' : 'desc' %>" class="btn">Update </a>  
                <a href="/users/disabled/<%= res.id %>?page=<%= currentPage || 1 %>&sortBy=<%= sortBy || 'createdAt' %>&order=<%= order === 1 ? 'asc' : 'desc' %>" class="btn btn-disabled" onclick="return confirm('Are you sure you want to disabled this ?')">Disabled</a>   
            </aside>
        </div>
    <% }) %>


    
 <% if (totalPages > 1) { %>
<div class="pagingcontrols">
  <% if (currentPage > 1) { %>
    <a href="?page=<%= currentPage - 1 %>&sortBy=<%= sortBy %>&order=<%= order === 1 ? 'asc' : 'desc' %>">Previous</a>
  <% } %>

  <% for (let i = 1; i <= totalPages; i++) { %>
    <% if (i === currentPage) { %>
      <b><%= i %></b>
    <% } else { %>
      <a href="?page=<%= i %>&sortBy=<%= sortBy %>&order=<%= order === 1 ? 'asc' : 'desc' %>"><%= i %></a>
    <% } %>
  <% } %>

  <% if (currentPage < totalPages) { %>
    <a href="?page=<%= currentPage + 1 %>&sortBy=<%= sortBy %>&order=<%= order === 1 ? 'asc' : 'desc' %>">Next</a>
  <% } %>
</div>
 <% } %>


 
</section>
<%- include('../partials/footer', { title: 'EMP Management System' }) %>
</body>
</html>
