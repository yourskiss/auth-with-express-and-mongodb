<!DOCTYPE html>
<html>
<head>
  <title>All User List</title>

</head>
<body>
<%- include('../partials/header') %>
<section class="sectionmin">

  <h1 class="mainheading">
    <% if (user.role === 'superadmin') { %>Admin List<% } else {  %>User List <% } %>
  </h1>
 
  <% if (error) { %>
      <h6 class="mainError"><%= error %></h6>
  <% }   %>

<div class="sortcontrols">
  <% 
    const primary = sortBy === 'createdAt';
    const secondary = sortBy === 'fullname'; 
  %>
  <p>
    <b>Sort : &nbsp;</b>
    <a href="?sortBy=fullname&order=<%= secondary && order === 1 ? 'desc' : 'asc' %>" class="<%= secondary ? 'active' : '' %>">
     By Name <%= secondary ? (order === 1 ? '▲' : '▼') : ' ' %>
    </a>
     &nbsp; 
    <a href="?sortBy=createdAt&order=<%= primary && order === 1 ? 'desc' : 'asc' %>" class="<%= primary ? 'active' : '' %>">
      By Date<%= primary ? (order === 1 ? '▲' : '▼') : ' ' %>
    </a>
     &nbsp; 
  </p>
</div>

    <% result.forEach((res) => { %>
        <div style="border: 1px solid #ccc; padding:5px 10px ; margin-bottom: 10px; width: 100%; display: flex; justify-content: space-between;">
            <p>
                <strong>Full Name:</strong> <%= res.fullname %> || <strong>Role:</strong> <%= res.role %><br> 
                <strong>Mobile:</strong> <%= res.mobile %> || <strong>Email:</strong> <%= res.email %><br>
                <strong>Created At:</strong> <%= new Date(res.createdAt).toLocaleString() %><br>
                <% 
                const createdDate = new Date(res.createdAt);
                const updatedDate = new Date(res.updatedAt);
                if (createdDate.getTime() < updatedDate.getTime()) { %>
                  <strong>Updated At:</strong> <%= new Date(res.updatedAt).toLocaleString() %><br>
                <% } %>
            </p>
            <div style="width:50%; display: flex; flex-wrap: wrap; justify-content: flex-end; gap: 10px; align-items:flex-start;">
                <a href="/users/detail/<%= res.id %>?page=<%= currentPage || 1 %>&sortBy=<%= sortBy || 'createdAt' %>&order=<%= order === 1 ? 'asc' : 'desc' %>" class="btn">View </a>  
                <a href="/users/update/<%= res.id %>?page=<%= currentPage || 1 %>&sortBy=<%= sortBy || 'createdAt' %>&order=<%= order === 1 ? 'asc' : 'desc' %>" class="btn">Update </a>  
                <a href="/users/delete/<%= res.id %>?page=<%= currentPage || 1 %>&sortBy=<%= sortBy || 'createdAt' %>&order=<%= order === 1 ? 'asc' : 'desc' %>" class="btn btn-delete" nsubmit="return confirm('Are you sure you want to delete this teacher?')"> Delete By Query String</a>   
                <form action="/users/delete/<%= res._id %>" method="POST" style="display: inline; margin: 0; padding: 0; width: auto;" onsubmit="return confirm('Are you sure you want to delete this User?')">
                  <input type="hidden" name="page" value="<%= currentPage || 1 %>">
                  <input type="hidden" name="sortBy" value="<%= sortBy || 'createdAt' %>">
                  <input type="hidden" name="order" value="<%= order === 1 ? 'asc' : 'desc' %>">
                  <button type="submit" class="btn btn-delete">Delete By Form</button>
                </form>
            </div>
        </div>
    <% }) %>


    
 <% if (totalPages > 1) { %>
<div class="pagingcontrols">
  <% if (currentPage > 1) { %>
    <a href="?page=<%= currentPage - 1 %>&sortBy=<%= sortBy %>&order=<%= order === 1 ? 'asc' : 'desc' %>">Previous</a>
  <% } %>

  <% for (let i = 1; i <= totalPages; i++) { %>
    <% if (i === currentPage) { %>
      <b><%= i %></b>
    <% } else { %>
      <a href="?page=<%= i %>&sortBy=<%= sortBy %>&order=<%= order === 1 ? 'asc' : 'desc' %>"><%= i %></a>
    <% } %>
  <% } %>

  <% if (currentPage < totalPages) { %>
    <a href="?page=<%= currentPage + 1 %>&sortBy=<%= sortBy %>&order=<%= order === 1 ? 'asc' : 'desc' %>">Next</a>
  <% } %>
</div>
 <% } %>


 
</section>
<%- include('../partials/footer', { title: 'EMP Management System' }) %>
</body>
</html>
